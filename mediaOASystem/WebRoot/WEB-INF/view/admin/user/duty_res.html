<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html> <!--<![endif]-->
<head>
<meta charset="utf-8" />
<title>新媒体智能管理系统</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport" />
<meta content="" name="description" />
<meta content="" name="author" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="renderer" content="webkit|ie-comp|ie-stand" />
<link href="$!webPath/resources/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="$!webPath/resources/assets/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" />
<link href="$!webPath/resources/assets/bootstrap/css/bootstrap-fileupload.css" rel="stylesheet" />
<link href="$!webPath/resources/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
<link href="$!webPath/resources/css/style.css" rel="stylesheet" />
<link href="$!webPath/resources/css/style_responsive.css" rel="stylesheet" />
<link href="$!webPath/resources/css/style_default.css" rel="stylesheet" id="style_color" />
<link href="$!webPath/resources/assets/chosen-bootstrap/chosen/v1.7/chosen.css" rel="stylesheet" type="text/css" />
<link href="$!webPath/resources/assets/fancybox/source/jquery.fancybox.css" rel="stylesheet" />
<link href="$!webPath/resources/assets/toastr/toastr.css" rel="stylesheet" type="text/css" />
<link href="$!webPath/resources/assets/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />
<link href="$!webPath/resources/assets/My97DatePicker/skin/WdatePicker.css" rel="stylesheet" type="text/css" />
<link href="$!webPath/resources/css/custom/custom.css" rel="stylesheet" type="text/css" />
</head>
<body class="fixed-top">
	<div id="header" class="navbar navbar-inverse navbar-fixed-top">
		$!httpInclude.include("/common/_header.htm") 
	</div>
	<div id="container" class="row-fluid">
		<div id="sidebar" class="nav-collapse collapse">
			$!httpInclude.include("/common/_sidebar.htm?op=department_manage") 
		</div>
		<div id="main-content">
			<div class="container-fluid">
				<div class="row-fluid">
					<div class="span12">
						<h3 class="page-title">组织机构</h3>
						<ul class="breadcrumb">
							<li><a href="$!webPath/index.htm"><i class="icon-home"></i></a><span class="divider">&nbsp;</span></li>
					        <li><a href="javascript:void(0);">人事管理</a><span class="divider">&nbsp;</span></li>
							<li><a href="$!webPath/admin/user/duty_res.htm?id=$!obj.id&currentPage=$!currentPage">岗位权限编辑</a><span class="divider-last">&nbsp;</span></li>
						</ul>
					</div>
				</div>
				<div class="row-fluid">
					<form name="theForm" id="theForm" action="$!webPath/admin/user/duty_res_save.htm" method="post" class="form-horizontal">
		            	<div class="span12">
							<div class="widget">
		                    	<div class="widget-title">
		                        	<h4><i class="icon-reorder"></i>岗位权限编辑</h4>
		                     	</div>
                     			<div class="widget-body form">
		                           	<div class="control-group">
		                           		<label class="control-label">岗位</label>
		                                <div class="controls"><span class="text">$!obj.department.department_name &gt; $!obj.duty_name</span></div>
		                           	</div>
		                            <div class="control-group">
                                   		<label class="control-label">权限管理</label>
                                        <div class="controls">
                                            #foreach($rg in $rgs)
											#if(!$rg.disabled)
											<div class="manage_box_title">
												<label>
													<input type="checkbox" name="rg_ck_$!rg.id" id="rg_ck_$!rg.id" value="$!rg.id"/>$!{rg.res_group_name}
												</label>
											</div>
											<div class="manage_box_main clearfix" id="manage_box_main_$!rg.id">
												#foreach($res in $rg.resList)
												#if(!$res.disabled)
												<label class="control-label">
													<input type="checkbox" name="res_$!res.id" id="res_$!res.id" value="$!res.id"
														#foreach($!res_id in $!dutyResIds) #if($!res_id==$!res.id)checked="checked" #end #end/>$!{res.res_name}
												</label>
												#end
												#end
											</div>
											#end
											#end
                                    	</div>
                                    	<input type="hidden" name="res_ids" id="res_ids"/>
                                    </div>
                           			<div class="form-actions">
                           				<input type="button" id="btn_submit" class="btn btn-primary" value="保存"/>
                           				<a href="$!webPath/admin/user/department_list.htm?currentPage=$!currentPage" class="btn">返回</a>
                           			</div>
	                     		</div>
	                  		</div>
		                </div>
		                <input type="hidden" name="currentPage" id="currentPage" value="$!currentPage"/>
		                <input type="hidden" name="id" id="id" value="$!obj.id"/>
				  	</form>
				</div>
			</div>
		</div>
	</div>
	<div id="footer">
		$!httpInclude.include("/common/_footer.htm")	
	</div>
	<script src="$!webPath/resources/js/jquery-1.8.3.min.js"></script>
    <script src="$!webPath/resources/assets/bootstrap/js/bootstrap.min.js"></script>   
    <script src="$!webPath/resources/js/jquery.blockui.js"></script>
    <!-- ie8 fixes -->
    <!--[if lt IE 9]>
    <script src="$!webPath/resources/js/excanvas.js"></script>
    <script src="$!webPath/resources/js/respond.js"></script>
    <![endif]-->   
    <script src="$!webPath/resources/assets/chosen-bootstrap/chosen/v1.7/chosen.jquery.js" type="text/javascript"></script>
    <script src="$!webPath/resources/assets/uniform/jquery.uniform.min.js" type="text/javascript"></script>
    <script src="$!webPath/resources/js/jquery.validate.min.js" type="text/javascript" ></script>
	<script src="$!webPath/resources/js/jquery.validate.ext.js" type="text/javascript" ></script>
	<script src="$!webPath/resources/js/jquery.form.min.js" type="text/javascript" ></script>
    <script src="$!webPath/resources/assets/My97DatePicker/WdatePicker.js" type="text/javascript" ></script>
    <script src="$!webPath/resources/assets/toastr/toastr.js" type="text/javascript" ></script>
    <script src="$!webPath/resources/js/scripts.js"></script>
    <script src="$!webPath/resources/js/custom/common.js"></script>
    <script>
	jQuery(document).ready(function() {   
		App.init();
		initToastr();
		bindEvent();
		bindCheckboxClick();
	});
	function bindEvent(){
		jQuery("#btn_submit").bind("click", function(){
			if (jQuery("#theForm").valid()) {
				jQuery("#loadingBar").show();
				setResIds();
				ajaxFormSubmit('theForm','defaultAjaxSaveCallBack');
			}
		});
	}
	function unBindEvent(){
		jQuery("#btn_submit").unbind();
	}
	function bindCheckboxClick(){
    	jQuery(":checkbox[id^=rg_ck_]").click(function(){
	   		 var val=jQuery(this).attr("id").substring(6);
	   		 var ck=jQuery(this).attr("checked") || jQuery(this).prop("checked");
	   		 var res_cks="div[id=manage_box_main_"+val+"] :checkbox";
	   		 if(ck=="checked" || ck==true){
	   			 jQuery(res_cks).attr("checked",true);
	   			 jQuery(res_cks).parent("span").attr("class", "checked");
	   		 }else{
	   			jQuery(res_cks).attr("checked",false);
	   			jQuery(res_cks).parent("span").attr("class", "");
	   		 }
	   	 });
    }
    function setResIds(){
    	var arr = [];
		jQuery(".manage_box_main input[type=checkbox]:checked").each(function(){
			var val = jQuery(this).val();
   			if(!isEmpty(val) && !contains(arr, val)){
   				arr.push(val);
   		 	}
		});
		jQuery("#res_ids").val(arr.join(","));
		console.log("res_ids==>"+jQuery("#res_ids").val());
    }
	</script>
</body>
</html>